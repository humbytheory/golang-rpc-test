# Generate CA Cert
# go run $GOROOT/src/crypto/tls/generate_cert.go -ca=true -host=MyCAServer

# Generate RPC Server cert and key
# go run $GOROOT/src/crypto/tls/generate_cert.go -host=localhost
# mv cert.pem MyRPCServer_cert.pem ; mv key.pem MyRPCServer_key.pem

# Generate RPC Client cert and key
# mv cert.pem MyRPCClient_cert.pem ; mv key.pem MyRPCClient_key.pem

### Above does not work since the server and client cert are not signed with the CA cert ###

# Using OpenSSL's easy-rsa script #
# https://github.com/OpenVPN/easy-rsa

# Get repo
git clone https://github.com/OpenVPN/easy-rsa.git example-ca

unzip ~/easy-rsa-master.zip
cd easy-rsa-master/easyrsa3/
cp vars.example vars

cat<<_end>>vars
set_var EASYRSA_REQ_COUNTRY="US"
set_var EASYRSA_REQ_PROVINCE="NY"
set_var EASYRSA_REQ_CITY="New York"
set_var EASYRSA_REQ_ORG="Wakka"
set_var EASYRSA_REQ_EMAIL="womeone@example.com"
set_var EASYRSA_REQ_OU="myOU"
_end

./easyrsa init-pki
./easyrsa build-ca
./easyrsa --subject-alt-name=IP:1.2.3.4 build-server-full myServer.com nopass
./easyrsa --subject-alt-name=IP:1.2.3.6 build-client-full myclient.com nopass

cd ../..
cp easy-rsa-master/easyrsa3/pki/ca.crt .
cp easy-rsa-master/easyrsa3/pki/issued/myclient.com.crt .
cp easy-rsa-master/easyrsa3/pki/issued/myServer.com.crt .
cp easy-rsa-master/easyrsa3/pki/private/myclient.com.key .
cp easy-rsa-master/easyrsa3/pki/private/myServer.com.key .
